<app-navbar></app-navbar>

<section class="registro-clinica">
  <div class="contenedor">
    <h2>Registro</h2>

    <div class="tabs">
      <button type="button" [class.active]="tipo === 'paciente'" (click)="tipo = 'paciente'">
        Paciente
      </button>
      <button
        type="button"
        [class.active]="tipo === 'especialista'"
        (click)="tipo = 'especialista'"
      >
        Especialista
      </button>
    </div>

    <ng-container [ngSwitch]="tipo">
      <!-- PACIENTE -->
      <form *ngSwitchCase="'paciente'" [formGroup]="formPaciente" (ngSubmit)="registrarPaciente()">
        <!-- Nombre -->
        <input formControlName="nombre" placeholder="Nombre" />
        <small
          class="error"
          *ngIf="formPaciente.get('nombre')?.touched && formPaciente.get('nombre')?.invalid"
        >
          Ingrese su nombre.
        </small>

        <!-- Apellido -->
        <input formControlName="apellido" placeholder="Apellido" />
        <small
          class="error"
          *ngIf="formPaciente.get('apellido')?.touched && formPaciente.get('apellido')?.invalid"
        >
          Ingrese su apellido.
        </small>

        <!-- Edad -->
        <input type="number" formControlName="edad" placeholder="Edad" />
        <small
          class="error"
          *ngIf="formPaciente.get('edad')?.touched && formPaciente.get('edad')?.invalid"
        >
          Ingrese una edad válida (mayor a 0).
        </small>

        <!-- DNI -->
        <input formControlName="dni" placeholder="DNI" />
        <small
          class="error"
          *ngIf="formPaciente.get('dni')?.touched && formPaciente.get('dni')?.invalid"
        >
          Ingrese un número de DNI válido.
        </small>

        <!-- Obra Social -->
        <input formControlName="obra_social" placeholder="Obra Social" />
        <small
          class="error"
          *ngIf="formPaciente.get('obra_social')?.touched && formPaciente.get('obra_social')?.invalid"
        >
          Indique su obra social.
        </small>

        <!-- Email -->
        <input type="email" formControlName="email" placeholder="Email" />
        <small
          class="error"
          *ngIf="formPaciente.get('email')?.touched && formPaciente.get('email')?.invalid"
        >
          Ingrese un correo válido.
        </small>

        <!-- Contraseña -->
        <input type="password" formControlName="password" placeholder="Contraseña" />
        <small
          class="error"
          *ngIf="formPaciente.get('password')?.touched && formPaciente.get('password')?.invalid"
        >
          La contraseña debe tener al menos 6 caracteres.
        </small>

        <!-- Uploader imágenes -->
        <app-image-uploader
          [multiple]="true"
          (files)="onFotosSeleccionadas($event)"
        ></app-image-uploader>

        <!-- Mensaje si faltan imágenes -->
        <p class="error" *ngIf="fotos.length < 2">
          * Debe subir 2 imágenes para habilitar el registro.
        </p>

        <button
          type="submit"
          [disabled]="loading || formPaciente.invalid || fotos.length !== 2"
        >
          Registrarse
        </button>
      </form>

      <!-- ESPECIALISTA -->
      <form
        *ngSwitchCase="'especialista'"
        [formGroup]="formEspecialista"
        (ngSubmit)="registrarEspecialista()"
      >
        <!-- Nombre -->
        <input formControlName="nombre" placeholder="Nombre" />
        <small
          class="error"
          *ngIf="formEspecialista.get('nombre')?.touched && formEspecialista.get('nombre')?.invalid"
        >
          Ingrese su nombre.
        </small>

        <!-- Apellido -->
        <input formControlName="apellido" placeholder="Apellido" />
        <small
          class="error"
          *ngIf="formEspecialista.get('apellido')?.touched && formEspecialista.get('apellido')?.invalid"
        >
          Ingrese su apellido.
        </small>

        <!-- Edad -->
        <input type="number" formControlName="edad" placeholder="Edad" />
        <small
          class="error"
          *ngIf="formEspecialista.get('edad')?.touched && formEspecialista.get('edad')?.invalid"
        >
          Ingrese una edad válida.
        </small>

        <!-- DNI -->
        <input formControlName="dni" placeholder="DNI" />
        <small
          class="error"
          *ngIf="formEspecialista.get('dni')?.touched && formEspecialista.get('dni')?.invalid"
        >
          Ingrese un número de DNI válido.
        </small>

        <!-- Especialidad -->
        <select formControlName="especialidad" (change)="onEspecialidadChange($event)">
          <option value="">Seleccione una especialidad</option>
          <option *ngFor="let esp of especialidades" [value]="esp">{{ esp }}</option>
          <option value="otra">Otra...</option>
        </select>
        <small
          class="error"
          *ngIf="formEspecialista.get('especialidad')?.touched && formEspecialista.get('especialidad')?.invalid"
        >
          Seleccione o agregue una especialidad.
        </small>

        <!-- Campo de nueva especialidad -->
        <input
          *ngIf="mostrarOtraEspecialidad"
          [(ngModel)]="nuevaEspecialidad"
          placeholder="Ingrese nueva especialidad"
        />
        <small class="error" *ngIf="mostrarOtraEspecialidad && !nuevaEspecialidad">
          Debe ingresar el nombre de la nueva especialidad.
        </small>

        <!-- Email -->
        <input type="email" formControlName="email" placeholder="Email" />
        <small
          class="error"
          *ngIf="formEspecialista.get('email')?.touched && formEspecialista.get('email')?.invalid"
        >
          Ingrese un correo válido.
        </small>

        <!-- Contraseña -->
        <input type="password" formControlName="password" placeholder="Contraseña" />
        <small
          class="error"
          *ngIf="formEspecialista.get('password')?.touched && formEspecialista.get('password')?.invalid"
        >
          La contraseña debe tener al menos 6 caracteres.
        </small>

        <!-- Uploader imagen -->
        <app-image-uploader
          [multiple]="false"
          (files)="onFotosSeleccionadas($event)"
        ></app-image-uploader>

        <!-- Mensaje si falta imagen -->
        <p class="error" *ngIf="fotos.length < 1">
          * Debe subir una imagen para habilitar el registro.
        </p>

        <button
          type="submit"
          [disabled]="loading || formEspecialista.invalid || fotos.length !== 1"
        >
          Registrarse
        </button>
      </form>
    </ng-container>

    <app-loading *ngIf="loading"></app-loading>
  </div>
</section>
