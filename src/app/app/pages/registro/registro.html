<app-navbar></app-navbar>

<div class="captcha-overlay" *ngIf="mostrarCaptcha">
  <div class="captcha-card">
    <h3>Verificación de seguridad</h3>
    <ngx-recaptcha2 [siteKey]="siteKey" (success)="onCaptchaResolved($event)"></ngx-recaptcha2>
    <button class="btn-cancelar" (click)="mostrarCaptcha = false">Cancelar</button>
  </div>
</div>

<section class="registro-clinica">
  <div class="contenedor">
    <div *ngIf="!tipoSeleccionado" class="seleccion-tipo">
      <h2>Registrarse como...</h2>
      <div class="botones-tipo">
        <button class="btn-tipo" (click)="seleccionarTipo('paciente')">
          <img src="assets/images/paciente.png" alt="Paciente" />
          <span>Paciente</span>
        </button>
        <button class="btn-tipo" (click)="seleccionarTipo('especialista')">
          <img src="assets/images/medico.png" alt="Especialista" />
          <span>Especialista</span>
        </button>
      </div>
    </div>

    <form
      *ngIf="tipoSeleccionado === 'paciente'"
      [formGroup]="formPaciente"
      (ngSubmit)="prepararRegistroPaciente()"
    >
      <button class="btn-volver" type="button" (click)="volver()">← Volver</button>
      <h2>Registro de Paciente</h2>

      <input formControlName="nombre" placeholder="Nombre" appAutoFocus />
      <input formControlName="apellido" placeholder="Apellido" />

      <input type="text" formControlName="edad" placeholder="Edad" appOnlyNumber />
      <input type="text" formControlName="dni" placeholder="DNI" appOnlyNumber />

      <input formControlName="obra_social" placeholder="Obra Social" />
      <input type="email" formControlName="email" placeholder="Email" />
      <input type="password" formControlName="password" placeholder="Contraseña" />

      <app-image-uploader
        [multiple]="true"
        (files)="onFotosSeleccionadas($event)"
      ></app-image-uploader>
      <p class="error" *ngIf="fotos.length < 2">* Debe subir 2 imágenes.</p>

      <button type="submit" [disabled]="loading || formPaciente.invalid || fotos.length !== 2">
        Registrarse
      </button>
    </form>

    <form
      *ngIf="tipoSeleccionado === 'especialista' && pasoEspecialista === 1"
      [formGroup]="formEspecialista"
      (ngSubmit)="continuarEspecialista()"
    >
      <button class="btn-volver" type="button" (click)="volver()">← Volver</button>
      <h2>Registro de Especialista (1/2)</h2>

      <input formControlName="nombre" placeholder="Nombre" appAutoFocus />
      <input formControlName="apellido" placeholder="Apellido" />
      <input type="text" formControlName="edad" placeholder="Edad" appOnlyNumber />
      <input type="text" formControlName="dni" placeholder="DNI" appOnlyNumber />
      <input type="email" formControlName="email" placeholder="Email" />
      <input type="password" formControlName="password" placeholder="Contraseña" />

      <app-image-uploader
        [multiple]="false"
        (files)="onFotosSeleccionadas($event)"
      ></app-image-uploader>
      <p class="error" *ngIf="fotos.length < 1">* Debe subir una imagen.</p>

      <button type="submit">Siguiente</button>
    </form>

    <div
      *ngIf="tipoSeleccionado === 'especialista' && pasoEspecialista === 2"
      class="paso-especialidades"
    >
      <button class="btn-volver" type="button" (click)="pasoEspecialista = 1">← Volver</button>
      <h2>Registro de Especialista (2/2)</h2>

      <div class="especialidades-container">
        <h3>Seleccioná tus especialidades</h3>
        <div class="carrusel-wrapper">
          <button type="button" class="flecha izquierda" (click)="scrollCarrusel('izquierda')">
            ‹
          </button>

          <div class="carrusel" #carrusel>
            <div
              class="opcion"
              *ngFor="let esp of especialidades"
              [class.seleccionado]="especialidadesSeleccionadas.includes(esp.nombre)"
              (click)="toggleEspecialidad(esp.nombre)"
            >
              <img [src]="'assets/images/' + esp.archivo" [alt]="esp.nombre" />
              <span>{{ esp.nombre }}</span>
            </div>

            <div
              class="opcion"
              [class.seleccionado]="mostrarOtraEspecialidad"
              (click)="toggleOtra()"
            >
              <img src="assets/images/otra.png" alt="Otra" />
              <span>Otra...</span>
            </div>
          </div>

          <button type="button" class="flecha derecha" (click)="scrollCarrusel('derecha')">
            ›
          </button>
        </div>

        <input
          *ngIf="mostrarOtraEspecialidad"
          [(ngModel)]="nuevaEspecialidad"
          placeholder="(Ejemplo: Gastroenterología, Pediatría)"
          appAutoFocus
        />
        <small *ngIf="mostrarOtraEspecialidad" class="info-ayuda">
          -------------------Podés ingresar más de una, separadas por comas-------------------
        </small>
      </div>

      <button class="btn-registrarse" type="button" (click)="prepararRegistroEspecialista()">
        Registrarse
      </button>
    </div>

    <app-loading *ngIf="loading"></app-loading>
  </div>
</section>
