<app-HeaderPropio></app-HeaderPropio>

<section class="solicitar-turno">
  <div class="contenedor-turno">
    <h2>ü©∫ Sacar un Turno</h2>

    <div *ngIf="!especialistaSeleccionado" class="paso fade-in">
      <h3>Seleccion√° un profesional</h3>
      <div class="lista-profesionales">
        <div
          *ngFor="let esp of especialistas"
          class="btn-profesional"
          [class.seleccionado]="especialistaSeleccionado?.id === esp.id"
          (click)="seleccionarEspecialista(esp)"
        >
          <img
            [src]="esp.foto_url || 'assets/images/usuario-default.png'"
            alt="Foto especialista"
          />
          <span>{{ esp.usuarios?.nombre }} {{ esp.usuarios?.apellido }}</span>
        </div>
      </div>
    </div>

    <div *ngIf="especialistaSeleccionado && !especialidadSeleccionada" class="paso fade-in">
      <button class="btn-volver" (click)="especialistaSeleccionado = null">‚Üê Volver</button>
      <h3>Seleccion√° una especialidad</h3>

      <div class="lista-especialidades">
        <div
          *ngFor="let e of especialidades"
          class="card-especialidad"
          [class.seleccionado]="especialidadSeleccionada === e"
          (click)="especialidadSeleccionada = e; generarFechasDisponibles()"
        >
          <img [src]="getEspecialidadImage(e)" alt="Imagen especialidad" />

          <p>{{ e }}</p>
        </div>
      </div>
    </div>

    <div *ngIf="especialidadSeleccionada && !fechaSeleccionada" class="paso fade-in">
      <button class="btn-volver" (click)="especialidadSeleccionada = ''">‚Üê Volver</button>
      <h3>Seleccion√° un d√≠a disponible</h3>

      <div class="lista-dias" *ngIf="fechasDisponibles.length; else sinFechas">
        <button
          *ngFor="let f of fechasDisponibles"
          class="btn-dia"
          [class.seleccionado]="fechaSeleccionada === f"
          (click)="fechaSeleccionada = f; cargarHorariosDisponibles()"
        >
          {{ f | date : 'dd-MM-yyyy' }}
        </button>
      </div>

      <ng-template #sinFechas>
        <p class="mensaje-vacio">üìÖ No hay fechas disponibles para este profesional.</p>
      </ng-template>
    </div>

    <div *ngIf="fechaSeleccionada && !horaSeleccionada" class="paso fade-in">
      <button class="btn-volver" (click)="fechaSeleccionada = ''">‚Üê Volver</button>
      <h3>Seleccion√° un horario</h3>

      <div class="lista-horarios" *ngIf="horariosDisponibles.length; else sinHorarios">
        <button
          *ngFor="let h of horariosDisponibles"
          class="btn-horario"
          [class.seleccionado]="horaSeleccionada === h"
          (click)="horaSeleccionada = h"
        >
          {{ h }}
        </button>
      </div>

      <ng-template #sinHorarios>
        <p class="mensaje-vacio">‚è∞ No hay horarios disponibles para la fecha seleccionada.</p>
      </ng-template>
    </div>

    <div *ngIf="horaSeleccionada" class="paso fade-in">
      <button class="btn-volver" (click)="horaSeleccionada = ''">‚Üê Volver</button>
      <h3>Confirmar Turno</h3>
      <p class="resumen">
        <strong>Profesional:</strong> {{ especialistaSeleccionado?.usuarios?.nombre }}
        {{ especialistaSeleccionado?.usuarios?.apellido }}<br />
        <strong>Especialidad:</strong> {{ especialidadSeleccionada }}<br />
        <strong>Fecha:</strong> {{ fechaSeleccionada | date : 'dd-MM-yyyy' }}<br />
        <strong>Hora:</strong> {{ horaSeleccionada }}
      </p>
      <button class="btn-confirmar" (click)="confirmarTurno()">Confirmar Turno</button>
    </div>
  </div>
</section>
